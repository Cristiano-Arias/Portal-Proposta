<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Propostas - Portal Integral</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: 'Segoe UI', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container { max-width: 1400px; margin: 0 auto; padding: 20px; }

        .header {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            text-align: center;
        }

        /* Sistema Principal */
        .sistema-principal {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
        }

        .sidebar {
            width: 250px;
            background: rgba(44, 62, 80, 0.95);
            border-radius: 15px;
            padding: 20px;
            height: fit-content;
        }

        .sidebar h2 {
            color: white;
            text-align: center;
            margin-bottom: 20px;
            font-size: 18px;
        }

        .menu-item {
            display: block;
            width: 100%;
            padding: 12px 15px;
            margin-bottom: 8px;
            background: transparent;
            color: white;
            border: 2px solid transparent;
            border-radius: 8px;
            text-align: left;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 14px;
        }

        .menu-item:hover {
            background: rgba(255, 255, 255, 0.1);
            border-color: rgba(255, 255, 255, 0.3);
        }

        .menu-item.active {
            background: #3498db;
            border-color: #2980b9;
        }

        .content-area {
            flex: 1;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 25px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
        }

        /* Portal Completo - Estilos do portal-propostas4.html */
        .portal-container {
            display: none;
        }

        .portal-container.active {
            display: block;
        }

        .processo-info {
            background: linear-gradient(45deg, #3498db, #2980b9);
            color: white;
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 20px;
        }
        
        .processo-info input {
            background: transparent;
            border: 1px solid white;
            color: white;
            padding: 2px 8px;
            border-radius: 4px;
        }
        
        .processo-info input#objetoProcesso {
            width: 400px;
        }

        .progress-container {
            background: white;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
        }

        .progress-bar {
            background: #ecf0f1;
            height: 6px;
            border-radius: 3px;
            overflow: hidden;
        }

        .progress-fill {
            background: linear-gradient(45deg, #3498db, #2980b9);
            height: 100%;
            transition: width 0.3s ease;
            width: 0%;
        }

        .tabs {
            display: flex;
            background: white;
            border-radius: 15px;
            margin-bottom: 20px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            flex-wrap: wrap;
        }

        .tab {
            flex: 1;
            min-width: 140px;
            padding: 12px 8px;
            text-align: center;
            cursor: pointer;
            background: #f8f9fa;
            border: none;
            font-size: 12px;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .tab.active { background: #3498db; color: white; }

        .form-section {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            display: none;
        }

        .form-section.active { display: block; }

        .section-title {
            background: linear-gradient(45deg, #9b59b6, #8e44ad);
            color: white;
            padding: 12px 20px;
            border-radius: 8px;
            margin: 15px 0;
            font-weight: 600;
            font-size: 14px;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 15px;
        }

        .form-row.single { grid-template-columns: 1fr; }
        .form-row.triple { grid-template-columns: 1fr 1fr 1fr; }

        .form-group { margin-bottom: 15px; }

        label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: #2c3e50;
            font-size: 13px;
        }

        input, textarea, select {
            width: 100%;
            padding: 10px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.3s ease;
        }

        input:focus, textarea:focus, select:focus {
            outline: none;
            border-color: #3498db;
        }

        textarea { min-height: 80px; resize: vertical; }

        .btn {
            padding: 12px 25px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            font-size: 14px;
        }

        .btn-primary {
            background: linear-gradient(45deg, #3498db, #2980b9);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(52, 152, 219, 0.4);
        }

        .btn-success {
            background: linear-gradient(45deg, #27ae60, #229954);
            color: white;
        }

        .btn-success:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(39, 174, 96, 0.4);
        }

        .btn-danger {
            background: linear-gradient(45deg, #e74c3c, #c0392b);
            color: white;
        }

        .btn-danger:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(231, 76, 60, 0.4);
        }

        .btn-secondary {
            background: #95a5a6;
            color: white;
        }

        .btn-secondary:hover {
            background: #7f8c8d;
        }

        /* Tabelas din√¢micas */
        .table-container {
            overflow-x: auto;
            margin: 20px 0;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        th {
            background: linear-gradient(45deg, #34495e, #2c3e50);
            color: white;
            padding: 12px 8px;
            text-align: left;
            font-weight: 600;
            font-size: 12px;
        }

        td {
            padding: 10px 8px;
            border-bottom: 1px solid #ecf0f1;
        }

        td input {
            border: 1px solid #ddd;
            padding: 6px;
            font-size: 12px;
        }

        .total-row {
            background: #f8f9fa;
            font-weight: bold;
        }

        .total-value {
            background: #d4edda;
            color: #155724;
            font-weight: bold;
            font-size: 16px;
        }

        /* Cards de resumo */
        .cards-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }

        .card {
            background: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            text-align: center;
            transition: transform 0.3s ease;
        }

        .card:hover {
            transform: translateY(-5px);
        }

        .card-title {
            font-size: 14px;
            color: #7f8c8d;
            margin-bottom: 10px;
        }

        .card-value {
            font-size: 24px;
            font-weight: bold;
            color: #2c3e50;
        }

        .card-primary { border-left: 4px solid #3498db; }
        .card-success { border-left: 4px solid #27ae60; }
        .card-warning { border-left: 4px solid #f39c12; }
        .card-danger { border-left: 4px solid #e74c3c; }

        /* Alertas */
        .alert {
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            font-weight: 500;
        }

        .alert-success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .alert-warning {
            background: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
        }

        .alert-danger {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        /* Responsividade */
        @media (max-width: 768px) {
            .sistema-principal {
                flex-direction: column;
            }
            
            .sidebar {
                width: 100%;
            }
            
            .form-row {
                grid-template-columns: 1fr;
            }
            
            .tabs {
                flex-direction: column;
            }
            
            .tab {
                min-width: auto;
            }
        }

        /* Estilos espec√≠ficos para cronograma autom√°tico */
        .cronograma-automatico {
            background: #e8f5e8;
            border: 2px solid #27ae60;
            border-radius: 10px;
            padding: 15px;
            margin: 15px 0;
        }

        .cronograma-automatico h4 {
            color: #27ae60;
            margin-bottom: 10px;
        }

        .cronograma-input {
            display: flex;
            gap: 10px;
            align-items: center;
            margin-bottom: 10px;
        }

        .cronograma-input label {
            min-width: 150px;
            margin-bottom: 0;
        }

        .cronograma-input input {
            max-width: 100px;
        }

        .cronograma-gerado {
            background: white;
            border-radius: 8px;
            padding: 15px;
            margin-top: 15px;
        }

        /* Estilos para controle de CNPJ */
        .cnpj-status {
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
            font-weight: bold;
        }

        .cnpj-liberado {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .cnpj-bloqueado {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        /* Estilos para valor total corrigido */
        .valor-total-container {
            background: #fff3cd;
            border: 2px solid #ffc107;
            border-radius: 10px;
            padding: 15px;
            margin: 15px 0;
        }

        .valor-total-container h4 {
            color: #856404;
            margin-bottom: 10px;
        }

        .valor-display {
            font-size: 24px;
            font-weight: bold;
            color: #155724;
            text-align: center;
            background: #d4edda;
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üè¢ Sistema de Gest√£o de Propostas</h1>
            <p>Portal Integrado para Administra√ß√£o e Fornecedores</p>
        </div>

        <div class="sistema-principal">
            <div class="sidebar">
                <h2>üìã Menu Principal</h2>
                <button class="menu-item active" onclick="mostrarSecao('dashboard')">üìä Dashboard</button>
                <button class="menu-item" onclick="mostrarSecao('processos')">üìã Processos</button>
                <button class="menu-item" onclick="mostrarSecao('cadastrar')">‚ûï Cadastrar Processo</button>
                <button class="menu-item" onclick="mostrarSecao('relatorios')">üìà Relat√≥rios</button>
                <button class="menu-item" onclick="abrirPortal()">üè≠ Portal Fornecedor</button>
            </div>

            <div class="content-area">
                <!-- Dashboard -->
                <div id="dashboard" class="secao active">
                    <h2>üìä Dashboard</h2>
                    <div class="cards-container">
                        <div class="card card-primary">
                            <div class="card-title">Processos Ativos</div>
                            <div class="card-value" id="processosAtivos">0</div>
                        </div>
                        <div class="card card-success">
                            <div class="card-title">Propostas Recebidas</div>
                            <div class="card-value" id="propostasRecebidas">0</div>
                        </div>
                        <div class="card card-warning">
                            <div class="card-title">Em An√°lise</div>
                            <div class="card-value" id="emAnalise">0</div>
                        </div>
                        <div class="card card-danger">
                            <div class="card-title">Finalizados</div>
                            <div class="card-value" id="finalizados">0</div>
                        </div>
                    </div>

                    <h3>üìã Processos Recentes</h3>
                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>N√∫mero</th>
                                    <th>Modalidade</th>
                                    <th>Objeto</th>
                                    <th>Status</th>
                                    <th>Data Limite</th>
                                    <th>A√ß√µes</th>
                                </tr>
                            </thead>
                            <tbody id="processosRecentes">
                                <tr>
                                    <td colspan="6" style="text-align: center; color: #7f8c8d;">Nenhum processo cadastrado</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>

                    <h3>üìà Atividades Recentes</h3>
                    <div id="atividadesRecentes">
                        <p style="color: #7f8c8d; text-align: center;">Nenhuma atividade registrada</p>
                    </div>
                </div>

                <!-- Processos -->
                <div id="processos" class="secao">
                    <h2>üìã Lista de Processos</h2>
                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>N√∫mero</th>
                                    <th>Modalidade</th>
                                    <th>Objeto</th>
                                    <th>Valor Estimado</th>
                                    <th>Status</th>
                                    <th>Data Limite</th>
                                    <th>Link Portal</th>
                                    <th>A√ß√µes</th>
                                </tr>
                            </thead>
                            <tbody id="listaProcessos">
                                <tr>
                                    <td colspan="8" style="text-align: center; color: #7f8c8d;">Nenhum processo cadastrado</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Cadastrar Processo -->
                <div id="cadastrar" class="secao">
                    <h2>‚ûï Cadastrar Novo Processo</h2>
                    <form id="formCadastro">
                        <div class="form-row">
                            <div class="form-group">
                                <label for="numeroProcesso">N√∫mero do Processo *</label>
                                <input type="text" id="numeroProcesso" required placeholder="Ex: LIC-2025-001">
                            </div>
                            <div class="form-group">
                                <label for="modalidade">Modalidade *</label>
                                <select id="modalidade" required>
                                    <option value="">Selecione...</option>
                                    <option value="Concorr√™ncia">Concorr√™ncia</option>
                                    <option value="Tomada de Pre√ßos">Tomada de Pre√ßos</option>
                                    <option value="Convite">Convite</option>
                                    <option value="Preg√£o">Preg√£o</option>
                                    <option value="Preg√£o Eletr√¥nico">Preg√£o Eletr√¥nico</option>
                                </select>
                            </div>
                        </div>

                        <div class="form-row single">
                            <div class="form-group">
                                <label for="objeto">Objeto da Licita√ß√£o *</label>
                                <textarea id="objeto" required placeholder="Descreva o objeto da licita√ß√£o..."></textarea>
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label for="valorEstimado">Valor Estimado (R$)</label>
                                <input type="number" id="valorEstimado" step="0.01" placeholder="0,00">
                            </div>
                            <div class="form-group">
                                <label for="prazoEntrega">Prazo de Entrega (dias)</label>
                                <input type="number" id="prazoEntrega" placeholder="Ex: 90">
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label for="dataAbertura">Data de Abertura *</label>
                                <input type="datetime-local" id="dataAbertura" required>
                            </div>
                            <div class="form-group">
                                <label for="dataLimite">Data Limite para Propostas *</label>
                                <input type="datetime-local" id="dataLimite" required>
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label for="responsavel">Respons√°vel *</label>
                                <input type="text" id="responsavel" required placeholder="Nome do respons√°vel">
                            </div>
                            <div class="form-group">
                                <label for="emailContato">E-mail de Contato *</label>
                                <input type="email" id="emailContato" required placeholder="email@empresa.com">
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label for="telefoneContato">Telefone de Contato</label>
                                <input type="tel" id="telefoneContato" placeholder="(11) 99999-9999">
                            </div>
                            <div class="form-group">
                                <label for="statusProcesso">Status</label>
                                <select id="statusProcesso">
                                    <option value="Rascunho">Rascunho</option>
                                    <option value="Publicado">Publicado</option>
                                    <option value="Em Andamento">Em Andamento</option>
                                    <option value="Finalizado">Finalizado</option>
                                </select>
                            </div>
                        </div>

                        <div style="text-align: center; margin-top: 20px;">
                            <button type="submit" class="btn btn-primary">CADASTRAR PROCESSO</button>
                        </div>
                    </form>
                </div>

                <!-- Relat√≥rios -->
                <div id="relatorios" class="secao">
                    <h2>üìà Relat√≥rios</h2>
                    <p>Funcionalidade em desenvolvimento...</p>
                </div>
            </div>
        </div>

        <!-- Portal Fornecedor Completo -->
        <div class="portal-container" id="portalContainer">
            <div class="processo-info">
                <h2>üè≠ Portal do Fornecedor</h2>
                <p>Processo: <input type="text" id="numeroProcessoPortal" value="LIC-2025-001" readonly style="background: rgba(255,255,255,0.2);"></p>
                <p>Objeto: <input type="text" id="objetoProcesso" value="Constru√ß√£o de Centro de Sa√∫de Municipal" readonly style="background: rgba(255,255,255,0.2);"></p>
            </div>

            <div class="progress-container">
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill"></div>
                </div>
                <p style="text-align: center; margin-top: 10px;">
                    Progresso: <span id="progressText">0%</span> - <span id="progressStatus">Iniciando proposta</span>
                </p>
            </div>

            <div class="tabs">
                <button class="tab active" onclick="mostrarAba('dados')">üìã Dados Cadastrais</button>
                <button class="tab" onclick="mostrarAba('resumo')">üìä Resumo</button>
                <button class="tab" onclick="mostrarAba('tecnica')">üìã Proposta T√©cnica</button>
                <button class="tab" onclick="mostrarAba('comercial')">üí∞ Proposta Comercial</button>
                <button class="tab" onclick="mostrarAba('revisao')">üìã Revis√£o Final</button>
            </div>

            <!-- Se√ß√£o 1: Dados Cadastrais -->
            <div id="dados" class="form-section active">
                <div class="section-title">üìã 1. DADOS CADASTRAIS DA EMPRESA</div>
                
                <!-- Controle de CNPJ por Processo -->
                <div id="cnpjStatus" class="cnpj-status" style="display: none;">
                    <span id="cnpjStatusText"></span>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="razaoSocial">Raz√£o Social *</label>
                        <input type="text" id="razaoSocial" required>
                    </div>
                    <div class="form-group">
                        <label for="cnpj">CNPJ *</label>
                        <input type="text" id="cnpj" required placeholder="00.000.000/0001-00" onblur="verificarCNPJ()">
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="endereco">Endere√ßo Completo *</label>
                        <input type="text" id="endereco" required>
                    </div>
                    <div class="form-group">
                        <label for="cidade">Cidade/UF *</label>
                        <input type="text" id="cidade" required>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="telefone">Telefone *</label>
                        <input type="tel" id="telefone" required>
                    </div>
                    <div class="form-group">
                        <label for="email">E-mail *</label>
                        <input type="email" id="email" required>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="respTecnico">Respons√°vel T√©cnico *</label>
                        <input type="text" id="respTecnico" required>
                    </div>
                    <div class="form-group">
                        <label for="crea">CREA/CAU *</label>
                        <input type="text" id="crea" required>
                    </div>
                </div>
            </div>

            <!-- Se√ß√£o 2: Resumo -->
            <div id="resumo" class="form-section">
                <div class="section-title">üìä 2. RESUMO DA PROPOSTA</div>
                
                <div class="cards-container">
                    <div class="card card-primary">
                        <div class="card-title">Processo</div>
                        <div class="card-value" id="resumoProcesso">LIC-2025-001</div>
                    </div>
                    <div class="card card-success">
                        <div class="card-title">Modalidade</div>
                        <div class="card-value" id="resumoModalidade">Concorr√™ncia</div>
                    </div>
                    <div class="card card-warning">
                        <div class="card-title">Valor Estimado</div>
                        <div class="card-value" id="resumoValorEstimado">R$ 3.500.000,00</div>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="prazoExecucao">Prazo de Execu√ß√£o (dias) *</label>
                        <input type="number" id="prazoExecucao" required placeholder="Ex: 240">
                    </div>
                    <div class="form-group">
                        <label for="formaPagamento">Forma de Pagamento *</label>
                        <select id="formaPagamento" required>
                            <option value="">Selecione...</option>
                            <option value="√Ä vista">√Ä vista</option>
                            <option value="30 dias">30 dias</option>
                            <option value="Parcelado">Parcelado</option>
                            <option value="Por medi√ß√£o">Por medi√ß√£o</option>
                        </select>
                    </div>
                </div>

                <!-- Valor Total Corrigido -->
                <div class="valor-total-container">
                    <h4>üí∞ VALOR TOTAL DA PROPOSTA</h4>
                    <p><strong>Importante:</strong> Este valor √© calculado automaticamente baseado no Custo Direto (M√£o de Obra + Materiais + Equipamentos) + BDI</p>
                    <div class="valor-display" id="valorTotalProposta">R$ 0,00</div>
                    <p style="font-size: 12px; color: #856404; margin-top: 10px;">
                        * Valor atualizado automaticamente conforme preenchimento da se√ß√£o comercial
                    </p>
                </div>
            </div>

            <!-- Se√ß√£o 3: Proposta T√©cnica -->
            <div id="tecnica" class="form-section">
                <div class="section-title">üìã 3. PROPOSTA T√âCNICA COMPLETA</div>
                
                <div class="form-group">
                    <label for="objetoConcorrencia">3.1 Objeto da Concorr√™ncia *</label>
                    <textarea id="objetoConcorrencia" required placeholder="Descreva detalhadamente o objeto da concorr√™ncia..."></textarea>
                </div>

                <div class="form-group">
                    <label for="escopoInclusos">3.2 Servi√ßos Inclusos no Escopo *</label>
                    <textarea id="escopoInclusos" required placeholder="Liste todos os servi√ßos inclusos no escopo..."></textarea>
                </div>

                <div class="form-group">
                    <label for="escopoExclusos">3.3 Servi√ßos N√ÉO Inclusos no Escopo</label>
                    <textarea id="escopoExclusos" placeholder="Liste os servi√ßos que N√ÉO est√£o inclusos..."></textarea>
                </div>

                <div class="form-group">
                    <label for="metodologia">3.4 Metodologia de Execu√ß√£o *</label>
                    <textarea id="metodologia" required placeholder="Descreva a metodologia que ser√° utilizada..."></textarea>
                </div>

                <div class="form-group">
                    <label for="sequenciaExecucao">3.5 Sequ√™ncia de Execu√ß√£o *</label>
                    <textarea id="sequenciaExecucao" required placeholder="Descreva a sequ√™ncia de execu√ß√£o dos servi√ßos..."></textarea>
                </div>

                <!-- Cronograma Autom√°tico -->
                <div class="cronograma-automatico">
                    <h4>üìÖ 3.6 Cronograma Autom√°tico</h4>
                    <p>Informe apenas os dias de execu√ß√£o e o cronograma ser√° calculado automaticamente:</p>
                    
                    <div class="cronograma-input">
                        <label for="diasExecucao">Dias totais de execu√ß√£o:</label>
                        <input type="number" id="diasExecucao" placeholder="240" onchange="gerarCronogramaAutomatico()">
                        <span>dias</span>
                    </div>
                    
                    <div class="cronograma-input">
                        <label for="dataInicio">Data de in√≠cio:</label>
                        <input type="date" id="dataInicio" onchange="gerarCronogramaAutomatico()">
                    </div>
                    
                    <button type="button" class="btn btn-primary" onclick="gerarCronogramaAutomatico()">
                        üîÑ Gerar Cronograma Autom√°tico
                    </button>
                    
                    <div class="cronograma-gerado" id="cronogramaGerado" style="display: none;">
                        <h5>Cronograma Gerado:</h5>
                        <div id="cronogramaTabela"></div>
                    </div>
                </div>

                <div class="form-group">
                    <label for="estruturaCanteiro">3.7 Estrutura do Canteiro *</label>
                    <textarea id="estruturaCanteiro" required placeholder="Descreva a estrutura do canteiro de obras..."></textarea>
                </div>

                <div class="form-group">
                    <label for="obrigacoesContratada">3.8 Obriga√ß√µes da Contratada *</label>
                    <textarea id="obrigacoesContratada" required placeholder="Liste as obriga√ß√µes da empresa contratada..."></textarea>
                </div>

                <div class="form-group">
                    <label for="obrigacoesContratante">3.9 Obriga√ß√µes da Contratante</label>
                    <textarea id="obrigacoesContratante" placeholder="Liste as obriga√ß√µes da empresa contratante..."></textarea>
                </div>

                <div class="form-group">
                    <label for="garantias">3.10 Garantias Oferecidas *</label>
                    <textarea id="garantias" required placeholder="Descreva as garantias oferecidas..."></textarea>
                </div>

                <!-- Tabelas T√©cnicas -->
                <div class="section-title">üìã 3.11 RECURSOS NECESS√ÅRIOS</div>
                
                <h4>Equipe T√©cnica</h4>
                <div class="table-container">
                    <table id="tabelaEquipe">
                        <thead>
                            <tr>
                                <th>Fun√ß√£o</th>
                                <th>Quantidade</th>
                                <th>Tempo (meses)</th>
                                <th>A√ß√µes</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><input type="text" placeholder="Ex: Engenheiro Civil"></td>
                                <td><input type="number" placeholder="1"></td>
                                <td><input type="number" placeholder="8"></td>
                                <td><button type="button" class="btn btn-danger btn-sm" onclick="removerLinha(this)">Remover</button></td>
                            </tr>
                        </tbody>
                    </table>
                    <button type="button" class="btn btn-secondary" onclick="adicionarLinhaEquipe()">+ Adicionar Fun√ß√£o</button>
                </div>

                <h4>Lista de Materiais (Quantidades)</h4>
                <div class="table-container">
                    <table id="tabelaMateriais">
                        <thead>
                            <tr>
                                <th>Material</th>
                                <th>Especifica√ß√£o</th>
                                <th>Unidade</th>
                                <th>Quantidade</th>
                                <th>A√ß√µes</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><input type="text" placeholder="Ex: Cimento"></td>
                                <td><input type="text" placeholder="CP II-E-32"></td>
                                <td><input type="text" placeholder="sc"></td>
                                <td><input type="number" placeholder="100"></td>
                                <td><button type="button" class="btn btn-danger btn-sm" onclick="removerLinha(this)">Remover</button></td>
                            </tr>
                        </tbody>
                    </table>
                    <button type="button" class="btn btn-secondary" onclick="adicionarLinhaMateriais()">+ Adicionar Material</button>
                </div>

                <h4>Lista de Equipamentos (Quantidades)</h4>
                <div class="table-container">
                    <table id="tabelaEquipamentos">
                        <thead>
                            <tr>
                                <th>Equipamento</th>
                                <th>Especifica√ß√£o</th>
                                <th>Unidade</th>
                                <th>Quantidade</th>
                                <th>A√ß√µes</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><input type="text" placeholder="Ex: Betoneira"></td>
                                <td><input type="text" placeholder="400L"></td>
                                <td><input type="text" placeholder="un"></td>
                                <td><input type="number" placeholder="2"></td>
                                <td><button type="button" class="btn btn-danger btn-sm" onclick="removerLinha(this)">Remover</button></td>
                            </tr>
                        </tbody>
                    </table>
                    <button type="button" class="btn btn-secondary" onclick="adicionarLinhaEquipamentos()">+ Adicionar Equipamento</button>
                </div>

                <h4>Experi√™ncia da Empresa</h4>
                <div class="table-container">
                    <table id="tabelaExperiencia">
                        <thead>
                            <tr>
                                <th>Obra/Servi√ßo</th>
                                <th>Cliente</th>
                                <th>Valor</th>
                                <th>Ano</th>
                                <th>A√ß√µes</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><input type="text" placeholder="Ex: Constru√ß√£o de escola"></td>
                                <td><input type="text" placeholder="Prefeitura Municipal"></td>
                                <td><input type="text" placeholder="R$ 2.000.000,00"></td>
                                <td><input type="number" placeholder="2023"></td>
                                <td><button type="button" class="btn btn-danger btn-sm" onclick="removerLinha(this)">Remover</button></td>
                            </tr>
                        </tbody>
                    </table>
                    <button type="button" class="btn btn-secondary" onclick="adicionarLinhaExperiencia()">+ Adicionar Experi√™ncia</button>
                </div>

                <h4>Certifica√ß√µes e Qualifica√ß√µes</h4>
                <div class="table-container">
                    <table id="tabelaCertificacoes">
                        <thead>
                            <tr>
                                <th>Certifica√ß√£o</th>
                                <th>√ìrg√£o Emissor</th>
                                <th>Validade</th>
                                <th>A√ß√µes</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><input type="text" placeholder="Ex: ISO 9001"></td>
                                <td><input type="text" placeholder="ABNT"></td>
                                <td><input type="date"></td>
                                <td><button type="button" class="btn btn-danger btn-sm" onclick="removerLinha(this)">Remover</button></td>
                            </tr>
                        </tbody>
                    </table>
                    <button type="button" class="btn btn-secondary" onclick="adicionarLinhaCertificacoes()">+ Adicionar Certifica√ß√£o</button>
                </div>
            </div>

            <!-- Se√ß√£o 4: Proposta Comercial -->
            <div id="comercial" class="form-section">
                <div class="section-title">üí∞ 4. PROPOSTA COMERCIAL</div>
                
                <h4>4.1 Planilha de Servi√ßos</h4>
                <div class="table-container">
                    <table id="tabelaServicos">
                        <thead>
                            <tr>
                                <th>Item</th>
                                <th>Descri√ß√£o</th>
                                <th>Unidade</th>
                                <th>Quantidade</th>
                                <th>Pre√ßo Unit. (R$)</th>
                                <th>Total (R$)</th>
                                <th>A√ß√µes</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><input type="text" placeholder="1"></td>
                                <td><input type="text" placeholder="Descri√ß√£o do servi√ßo"></td>
                                <td><input type="text" placeholder="m¬≤"></td>
                                <td><input type="number" step="0.01" placeholder="100" onchange="calcularTotal(this)"></td>
                                <td><input type="number" step="0.01" placeholder="25.50" onchange="calcularTotal(this)"></td>
                                <td><input type="text" readonly class="total-cell"></td>
                                <td><button type="button" class="btn btn-danger btn-sm" onclick="removerLinha(this)">Remover</button></td>
                            </tr>
                        </tbody>
                        <tfoot>
                            <tr class="total-row">
                                <td colspan="5"><strong>TOTAL SERVI√áOS:</strong></td>
                                <td><strong id="totalServicos">R$ 0,00</strong></td>
                                <td></td>
                            </tr>
                        </tfoot>
                    </table>
                    <button type="button" class="btn btn-secondary" onclick="adicionarLinhaServicos()">+ Adicionar Servi√ßo</button>
                </div>

                <h4>4.2 Composi√ß√£o de M√£o de Obra</h4>
                <div class="table-container">
                    <table id="tabelaMaoObra">
                        <thead>
                            <tr>
                                <th>Fun√ß√£o</th>
                                <th>Qtd</th>
                                <th>Tempo (meses)</th>
                                <th>Sal√°rio (R$)</th>
                                <th>Encargos (%)</th>
                                <th>Total Mensal (R$)</th>
                                <th>Total Geral (R$)</th>
                                <th>A√ß√µes</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><input type="text" placeholder="Pedreiro"></td>
                                <td><input type="number" placeholder="2" onchange="calcularMaoObra(this)"></td>
                                <td><input type="number" placeholder="8" onchange="calcularMaoObra(this)"></td>
                                <td><input type="number" step="0.01" placeholder="2500" onchange="calcularMaoObra(this)"></td>
                                <td><input type="number" step="0.01" placeholder="80" onchange="calcularMaoObra(this)"></td>
                                <td><input type="text" readonly class="total-cell"></td>
                                <td><input type="text" readonly class="total-cell"></td>
                                <td><button type="button" class="btn btn-danger btn-sm" onclick="removerLinha(this)">Remover</button></td>
                            </tr>
                        </tbody>
                        <tfoot>
                            <tr class="total-row">
                                <td colspan="6"><strong>TOTAL M√ÉO DE OBRA:</strong></td>
                                <td><strong id="totalMaoObra">R$ 0,00</strong></td>
                                <td></td>
                            </tr>
                        </tfoot>
                    </table>
                    <button type="button" class="btn btn-secondary" onclick="adicionarLinhaMaoObra()">+ Adicionar Fun√ß√£o</button>
                </div>

                <h4>4.3 Lista de Materiais (Comercial)</h4>
                <div class="table-container">
                    <table id="tabelaMateriaisComercial">
                        <thead>
                            <tr>
                                <th>Material</th>
                                <th>Especifica√ß√£o</th>
                                <th>Unidade</th>
                                <th>Quantidade</th>
                                <th>Pre√ßo Unit. (R$)</th>
                                <th>Total (R$)</th>
                                <th>A√ß√µes</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><input type="text" placeholder="Cimento"></td>
                                <td><input type="text" placeholder="CP II-E-32"></td>
                                <td><input type="text" placeholder="sc"></td>
                                <td><input type="number" step="0.01" placeholder="100" onchange="calcularTotal(this)"></td>
                                <td><input type="number" step="0.01" placeholder="35.00" onchange="calcularTotal(this)"></td>
                                <td><input type="text" readonly class="total-cell"></td>
                                <td><button type="button" class="btn btn-danger btn-sm" onclick="removerLinha(this)">Remover</button></td>
                            </tr>
                        </tbody>
                        <tfoot>
                            <tr class="total-row">
                                <td colspan="5"><strong>TOTAL MATERIAIS:</strong></td>
                                <td><strong id="totalMateriais">R$ 0,00</strong></td>
                                <td></td>
                            </tr>
                        </tfoot>
                    </table>
                    <button type="button" class="btn btn-secondary" onclick="adicionarLinhaMateriaisComercial()">+ Adicionar Material</button>
                </div>

                <h4>4.4 Lista de Equipamentos (Comercial)</h4>
                <div class="table-container">
                    <table id="tabelaEquipamentosComercial">
                        <thead>
                            <tr>
                                <th>Equipamento</th>
                                <th>Especifica√ß√£o</th>
                                <th>Quantidade</th>
                                <th>Tempo (meses)</th>
                                <th>Pre√ßo/m√™s (R$)</th>
                                <th>Total (R$)</th>
                                <th>A√ß√µes</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><input type="text" placeholder="Betoneira"></td>
                                <td><input type="text" placeholder="400L"></td>
                                <td><input type="number" placeholder="2" onchange="calcularEquipamento(this)"></td>
                                <td><input type="number" placeholder="8" onchange="calcularEquipamento(this)"></td>
                                <td><input type="number" step="0.01" placeholder="800" onchange="calcularEquipamento(this)"></td>
                                <td><input type="text" readonly class="total-cell"></td>
                                <td><button type="button" class="btn btn-danger btn-sm" onclick="removerLinha(this)">Remover</button></td>
                            </tr>
                        </tbody>
                        <tfoot>
                            <tr class="total-row">
                                <td colspan="5"><strong>TOTAL EQUIPAMENTOS:</strong></td>
                                <td><strong id="totalEquipamentos">R$ 0,00</strong></td>
                                <td></td>
                            </tr>
                        </tfoot>
                    </table>
                    <button type="button" class="btn btn-secondary" onclick="adicionarLinhaEquipamentosComercial()">+ Adicionar Equipamento</button>
                </div>

                <h4>4.5 Composi√ß√£o do BDI</h4>
                <div class="table-container">
                    <table id="tabelaBDI">
                        <thead>
                            <tr>
                                <th>Item do BDI</th>
                                <th>Percentual (%)</th>
                                <th>A√ß√µes</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><input type="text" placeholder="Administra√ß√£o Central" value="Administra√ß√£o Central"></td>
                                <td><input type="number" step="0.01" placeholder="5.00" onchange="calcularBDI()"></td>
                                <td><button type="button" class="btn btn-danger btn-sm" onclick="removerLinha(this)">Remover</button></td>
                            </tr>
                            <tr>
                                <td><input type="text" placeholder="Lucro" value="Lucro"></td>
                                <td><input type="number" step="0.01" placeholder="8.00" onchange="calcularBDI()"></td>
                                <td><button type="button" class="btn btn-danger btn-sm" onclick="removerLinha(this)">Remover</button></td>
                            </tr>
                            <tr>
                                <td><input type="text" placeholder="Impostos" value="Impostos"></td>
                                <td><input type="number" step="0.01" placeholder="12.00" onchange="calcularBDI()"></td>
                                <td><button type="button" class="btn btn-danger btn-sm" onclick="removerLinha(this)">Remover</button></td>
                            </tr>
                        </tbody>
                        <tfoot>
                            <tr class="total-row">
                                <td><strong>TOTAL BDI:</strong></td>
                                <td><strong id="totalBDI">25,00%</strong></td>
                                <td></td>
                            </tr>
                        </tfoot>
                    </table>
                    <button type="button" class="btn btn-secondary" onclick="adicionarLinhaBDI()">+ Adicionar Item BDI</button>
                </div>

                <!-- Resumo Financeiro Corrigido -->
                <div class="section-title">üí∞ 4.6 RESUMO FINANCEIRO</div>
                <div class="table-container">
                    <table>
                        <tbody>
                            <tr>
                                <td><strong>Servi√ßos:</strong></td>
                                <td id="resumoServicos">R$ 0,00</td>
                            </tr>
                            <tr>
                                <td><strong>M√£o de Obra:</strong></td>
                                <td id="resumoMaoObra">R$ 0,00</td>
                            </tr>
                            <tr>
                                <td><strong>Materiais:</strong></td>
                                <td id="resumoMateriais">R$ 0,00</td>
                            </tr>
                            <tr>
                                <td><strong>Equipamentos:</strong></td>
                                <td id="resumoEquipamentos">R$ 0,00</td>
                            </tr>
                            <tr class="total-row">
                                <td><strong>CUSTO DIRETO (MO + Mat + Equip):</strong></td>
                                <td><strong id="custoDirecto">R$ 0,00</strong></td>
                            </tr>
                            <tr>
                                <td><strong>BDI (<span id="percentualBDI">25,00</span>%):</strong></td>
                                <td id="valorBDI">R$ 0,00</td>
                            </tr>
                            <tr class="total-value">
                                <td><strong>VALOR TOTAL DA PROPOSTA:</strong></td>
                                <td><strong id="valorTotal">R$ 0,00</strong></td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="validadeProposta">4.7 Validade da Proposta</label>
                        <select id="validadeProposta">
                            <option value="30 dias">30 dias</option>
                            <option value="60 dias" selected>60 dias</option>
                            <option value="90 dias">90 dias</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="condicoes">4.8 Condi√ß√µes</label>
                        <textarea id="condicoes" placeholder="Condi√ß√µes adicionais da proposta..."></textarea>
                    </div>
                </div>
            </div>

            <!-- Se√ß√£o 5: Revis√£o Final -->
            <div id="revisao" class="form-section">
                <div class="section-title">üìã 5. REVIS√ÉO FINAL</div>
                
                <div class="alert alert-warning">
                    <strong>‚ö†Ô∏è Aten√ß√£o:</strong> Revise todos os dados antes de enviar. Ap√≥s o envio, n√£o ser√° poss√≠vel fazer altera√ß√µes.
                </div>

                <h4>üìã Resumo da Empresa</h4>
                <div class="cards-container">
                    <div class="card">
                        <div class="card-title">Raz√£o Social</div>
                        <div class="card-value" id="revisaoRazaoSocial">-</div>
                    </div>
                    <div class="card">
                        <div class="card-title">CNPJ</div>
                        <div class="card-value" id="revisaoCNPJ">-</div>
                    </div>
                    <div class="card">
                        <div class="card-title">Respons√°vel T√©cnico</div>
                        <div class="card-value" id="revisaoRespTecnico">-</div>
                    </div>
                </div>

                <h4>üí∞ Resumo Financeiro</h4>
                <div class="table-container">
                    <table>
                        <tr>
                            <td><strong>Custo Direto:</strong></td>
                            <td id="revisaoCustoDirecto">R$ 0,00</td>
                        </tr>
                        <tr>
                            <td><strong>BDI:</strong></td>
                            <td id="revisaoBDI">R$ 0,00</td>
                        </tr>
                        <tr class="total-value">
                            <td><strong>VALOR TOTAL:</strong></td>
                            <td><strong id="revisaoValorTotal">R$ 0,00</strong></td>
                        </tr>
                        <tr>
                            <td><strong>Prazo:</strong></td>
                            <td id="revisaoPrazo">- dias</td>
                        </tr>
                        <tr>
                            <td><strong>Pagamento:</strong></td>
                            <td id="revisaoPagamento">-</td>
                        </tr>
                    </table>
                </div>

                <h4>üìã Declara√ß√µes</h4>
                <div class="form-group">
                    <label>
                        <input type="checkbox" id="declaracao1" required>
                        Declaro que todas as informa√ß√µes prestadas s√£o verdadeiras
                    </label>
                </div>
                <div class="form-group">
                    <label>
                        <input type="checkbox" id="declaracao2" required>
                        Estou ciente dos termos do edital e aceito todas as condi√ß√µes
                    </label>
                </div>
                <div class="form-group">
                    <label>
                        <input type="checkbox" id="declaracao3" required>
                        Confirmo que a empresa est√° regular perante os √≥rg√£os competentes
                    </label>
                </div>

                <div style="text-align: center; margin-top: 30px;">
                    <button type="button" class="btn btn-success" onclick="enviarProposta()" style="font-size: 18px; padding: 15px 40px;">
                        üì§ ENVIAR PROPOSTA
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Vari√°veis globais
        let processos = JSON.parse(localStorage.getItem('processos')) || [];
        let propostas = JSON.parse(localStorage.getItem('propostas')) || [];
        let currentTab = 'dados';
        let portalAberto = false;

        // Inicializa√ß√£o
        document.addEventListener('DOMContentLoaded', function() {
            atualizarDashboard();
            atualizarListaProcessos();
            carregarDadosPortal();
            
            // Auto-save a cada 30 segundos
            setInterval(salvarDadosPortal, 30000);
        });

        // Fun√ß√µes do Sistema Principal
        function mostrarSecao(secao) {
            // Esconder todas as se√ß√µes
            document.querySelectorAll('.secao').forEach(s => s.classList.remove('active'));
            document.querySelectorAll('.menu-item').forEach(m => m.classList.remove('active'));
            
            // Mostrar se√ß√£o selecionada
            document.getElementById(secao).classList.add('active');
            event.target.classList.add('active');
            
            // Esconder portal se estiver aberto
            document.getElementById('portalContainer').classList.remove('active');
            portalAberto = false;
        }

        function abrirPortal() {
            // Esconder sistema principal
            document.querySelectorAll('.secao').forEach(s => s.classList.remove('active'));
            document.querySelectorAll('.menu-item').forEach(m => m.classList.remove('active'));
            
            // Mostrar portal
            document.getElementById('portalContainer').classList.add('active');
            portalAberto = true;
            
            // Carregar dados do processo se houver par√¢metros na URL
            const urlParams = new URLSearchParams(window.location.search);
            const processoId = urlParams.get('processo');
            if (processoId) {
                carregarDadosProcesso(processoId);
            }
        }

        // Cadastro de Processos
        document.getElementById('formCadastro').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const processo = {
                id: Date.now(),
                numero: document.getElementById('numeroProcesso').value,
                modalidade: document.getElementById('modalidade').value,
                objeto: document.getElementById('objeto').value,
                valorEstimado: parseFloat(document.getElementById('valorEstimado').value) || 0,
                prazoEntrega: parseInt(document.getElementById('prazoEntrega').value) || 0,
                dataAbertura: document.getElementById('dataAbertura').value,
                dataLimite: document.getElementById('dataLimite').value,
                responsavel: document.getElementById('responsavel').value,
                emailContato: document.getElementById('emailContato').value,
                telefoneContato: document.getElementById('telefoneContato').value,
                status: document.getElementById('statusProcesso').value,
                dataCriacao: new Date().toISOString(),
                propostas: []
            };

            // Validar datas
            if (new Date(processo.dataLimite) >= new Date(processo.dataAbertura)) {
                alert('A data limite para propostas deve ser anterior √† data de abertura!');
                return;
            }

            processos.push(processo);
            localStorage.setItem('processos', JSON.stringify(processos));
            
            alert('Processo cadastrado com sucesso!');
            this.reset();
            atualizarDashboard();
            atualizarListaProcessos();
        });

        function atualizarDashboard() {
            const processosAtivos = processos.filter(p => p.status === 'Publicado' || p.status === 'Em Andamento').length;
            const propostasRecebidas = propostas.length;
            const emAnalise = propostas.filter(p => p.status === 'Em An√°lise').length;
            const finalizados = processos.filter(p => p.status === 'Finalizado').length;

            document.getElementById('processosAtivos').textContent = processosAtivos;
            document.getElementById('propostasRecebidas').textContent = propostasRecebidas;
            document.getElementById('emAnalise').textContent = emAnalise;
            document.getElementById('finalizados').textContent = finalizados;

            // Atualizar lista de processos recentes
            const tbody = document.getElementById('processosRecentes');
            tbody.innerHTML = '';
            
            if (processos.length === 0) {
                tbody.innerHTML = '<tr><td colspan="6" style="text-align: center; color: #7f8c8d;">Nenhum processo cadastrado</td></tr>';
            } else {
                processos.slice(-5).reverse().forEach(processo => {
                    const row = tbody.insertRow();
                    row.innerHTML = `
                        <td>${processo.numero}</td>
                        <td>${processo.modalidade}</td>
                        <td>${processo.objeto.substring(0, 50)}...</td>
                        <td><span class="badge badge-${getStatusColor(processo.status)}">${processo.status}</span></td>
                        <td>${new Date(processo.dataLimite).toLocaleDateString()}</td>
                        <td>
                            <button class="btn btn-sm btn-primary" onclick="gerarLinkPortal('${processo.numero}')">üîó Link</button>
                        </td>
                    `;
                });
            }
        }

        function atualizarListaProcessos() {
            const tbody = document.getElementById('listaProcessos');
            tbody.innerHTML = '';
            
            if (processos.length === 0) {
                tbody.innerHTML = '<tr><td colspan="8" style="text-align: center; color: #7f8c8d;">Nenhum processo cadastrado</td></tr>';
            } else {
                processos.forEach(processo => {
                    const row = tbody.insertRow();
                    row.innerHTML = `
                        <td>${processo.numero}</td>
                        <td>${processo.modalidade}</td>
                        <td>${processo.objeto.substring(0, 40)}...</td>
                        <td>R$ ${processo.valorEstimado.toLocaleString('pt-BR', {minimumFractionDigits: 2})}</td>
                        <td><span class="badge badge-${getStatusColor(processo.status)}">${processo.status}</span></td>
                        <td>${new Date(processo.dataLimite).toLocaleDateString()}</td>
                        <td>
                            <button class="btn btn-sm btn-primary" onclick="gerarLinkPortal('${processo.numero}')">üîó Gerar Link</button>
                        </td>
                        <td>
                            <button class="btn btn-sm btn-secondary" onclick="editarProcesso(${processo.id})">‚úèÔ∏è</button>
                            <button class="btn btn-sm btn-danger" onclick="excluirProcesso(${processo.id})">üóëÔ∏è</button>
                        </td>
                    `;
                });
            }
        }

        function getStatusColor(status) {
            switch(status) {
                case 'Publicado': return 'success';
                case 'Em Andamento': return 'warning';
                case 'Finalizado': return 'secondary';
                default: return 'primary';
            }
        }

        function gerarLinkPortal(numeroProcesso) {
            const baseUrl = window.location.href.split('?')[0];
            const link = `${baseUrl}?portal=true&processo=${numeroProcesso}`;
            
            navigator.clipboard.writeText(link).then(() => {
                alert(`Link copiado para a √°rea de transfer√™ncia:\n${link}`);
            }).catch(() => {
                prompt('Link do portal (Ctrl+C para copiar):', link);
            });
        }

        // Fun√ß√µes do Portal
        function mostrarAba(aba) {
            // Atualizar tabs
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.form-section').forEach(s => s.classList.remove('active'));
            
            event.target.classList.add('active');
            document.getElementById(aba).classList.add('active');
            
            currentTab = aba;
            atualizarProgresso();
            
            // Atualizar revis√£o se estiver na aba de revis√£o
            if (aba === 'revisao') {
                atualizarRevisao();
            }
        }

        function atualizarProgresso() {
            const progressos = {
                'dados': 20,
                'resumo': 40,
                'tecnica': 60,
                'comercial': 80,
                'revisao': 100
            };
            
            const status = {
                'dados': 'Preenchendo dados cadastrais',
                'resumo': 'Definindo resumo da proposta',
                'tecnica': 'Elaborando proposta t√©cnica',
                'comercial': 'Calculando valores comerciais',
                'revisao': 'Revis√£o final - pronto para envio'
            };
            
            const progresso = progressos[currentTab];
            document.getElementById('progressFill').style.width = progresso + '%';
            document.getElementById('progressText').textContent = progresso + '%';
            document.getElementById('progressStatus').textContent = status[currentTab];
        }

        // Verifica√ß√£o de CNPJ por processo
        function verificarCNPJ() {
            const cnpj = document.getElementById('cnpj').value;
            const numeroProcesso = document.getElementById('numeroProcessoPortal').value;
            
            if (!cnpj || cnpj.length < 14) return;
            
            // Verificar se j√° existe proposta deste CNPJ para este processo
            const propostaExistente = propostas.find(p => 
                p.dados.cnpj === cnpj && p.numeroProcesso === numeroProcesso
            );
            
            const statusDiv = document.getElementById('cnpjStatus');
            const statusText = document.getElementById('cnpjStatusText');
            
            if (propostaExistente) {
                statusDiv.className = 'cnpj-status cnpj-bloqueado';
                statusText.textContent = `‚ö†Ô∏è ATEN√á√ÉO: Este CNPJ j√° enviou uma proposta para este processo em ${new Date(propostaExistente.dataEnvio).toLocaleDateString()}. Apenas uma proposta por CNPJ √© permitida por processo.`;
                statusDiv.style.display = 'block';
                
                // Desabilitar envio
                document.querySelector('button[onclick="enviarProposta()"]').disabled = true;
            } else {
                statusDiv.className = 'cnpj-status cnpj-liberado';
                statusText.textContent = '‚úÖ CNPJ liberado para envio de proposta neste processo.';
                statusDiv.style.display = 'block';
                
                // Habilitar envio
                document.querySelector('button[onclick="enviarProposta()"]').disabled = false;
            }
        }

        // Cronograma Autom√°tico
        function gerarCronogramaAutomatico() {
            const diasExecucao = parseInt(document.getElementById('diasExecucao').value);
            const dataInicio = document.getElementById('dataInicio').value;
            
            if (!diasExecucao || !dataInicio) {
                alert('Por favor, preencha os dias de execu√ß√£o e a data de in√≠cio.');
                return;
            }
            
            const atividades = [
                { nome: 'Mobiliza√ß√£o e Instala√ß√£o do Canteiro', percentual: 5 },
                { nome: 'Servi√ßos Preliminares', percentual: 10 },
                { nome: 'Funda√ß√µes', percentual: 15 },
                { nome: 'Estrutura', percentual: 25 },
                { nome: 'Alvenaria e Veda√ß√µes', percentual: 15 },
                { nome: 'Cobertura', percentual: 10 },
                { nome: 'Instala√ß√µes', percentual: 15 },
                { nome: 'Acabamentos', percentual: 20 },
                { nome: 'Limpeza e Entrega', percentual: 5 }
            ];
            
            let cronogramaHTML = '<table style="width: 100%; border-collapse: collapse;">';
            cronogramaHTML += '<thead><tr style="background: #34495e; color: white;"><th style="padding: 8px; border: 1px solid #ddd;">Atividade</th><th>Dura√ß√£o (dias)</th><th>In√≠cio</th><th>Fim</th></tr></thead><tbody>';
            
            let dataAtual = new Date(dataInicio);
            
            atividades.forEach(atividade => {
                const duracaoAtividade = Math.round(diasExecucao * (atividade.percentual / 100));
                const dataFim = new Date(dataAtual);
                dataFim.setDate(dataFim.getDate() + duracaoAtividade - 1);
                
                cronogramaHTML += `
                    <tr>
                        <td style="padding: 8px; border: 1px solid #ddd;">${atividade.nome}</td>
                        <td style="padding: 8px; border: 1px solid #ddd; text-align: center;">${duracaoAtividade}</td>
                        <td style="padding: 8px; border: 1px solid #ddd; text-align: center;">${dataAtual.toLocaleDateString()}</td>
                        <td style="padding: 8px; border: 1px solid #ddd; text-align: center;">${dataFim.toLocaleDateString()}</td>
                    </tr>
                `;
                
                dataAtual.setDate(dataAtual.getDate() + duracaoAtividade);
            });
            
            cronogramaHTML += '</tbody></table>';
            
            document.getElementById('cronogramaTabela').innerHTML = cronogramaHTML;
            document.getElementById('cronogramaGerado').style.display = 'block';
            
            alert('Cronograma gerado automaticamente com sucesso!');
        }

        // Fun√ß√µes de c√°lculo
        function calcularTotal(input) {
            const row = input.closest('tr');
            const quantidade = parseFloat(row.cells[3].querySelector('input').value) || 0;
            const preco = parseFloat(row.cells[4].querySelector('input').value) || 0;
            const total = quantidade * preco;
            
            row.cells[5].querySelector('input').value = formatarMoeda(total);
            
            // Atualizar total da tabela
            const tabela = input.closest('table');
            atualizarTotalTabela(tabela);
        }

        function calcularMaoObra(input) {
            const row = input.closest('tr');
            const quantidade = parseFloat(row.cells[1].querySelector('input').value) || 0;
            const tempo = parseFloat(row.cells[2].querySelector('input').value) || 0;
            const salario = parseFloat(row.cells[3].querySelector('input').value) || 0;
            const encargos = parseFloat(row.cells[4].querySelector('input').value) || 0;
            
            const totalMensal = quantidade * salario * (1 + encargos/100);
            const totalGeral = totalMensal * tempo;
            
            row.cells[5].querySelector('input').value = formatarMoeda(totalMensal);
            row.cells[6].querySelector('input').value = formatarMoeda(totalGeral);
            
            atualizarTotalTabela(input.closest('table'));
        }

        function calcularEquipamento(input) {
            const row = input.closest('tr');
            const quantidade = parseFloat(row.cells[2].querySelector('input').value) || 0;
            const tempo = parseFloat(row.cells[3].querySelector('input').value) || 0;
            const preco = parseFloat(row.cells[4].querySelector('input').value) || 0;
            const total = quantidade * tempo * preco;
            
            row.cells[5].querySelector('input').value = formatarMoeda(total);
            atualizarTotalTabela(input.closest('table'));
        }

        function calcularBDI() {
            let totalBDI = 0;
            document.querySelectorAll('#tabelaBDI tbody tr').forEach(row => {
                const percentual = parseFloat(row.cells[1].querySelector('input').value) || 0;
                totalBDI += percentual;
            });
            
            document.getElementById('totalBDI').textContent = totalBDI.toFixed(2) + '%';
            atualizarResumoFinanceiro();
        }

        function atualizarTotalTabela(tabela) {
            let total = 0;
            const rows = tabela.querySelectorAll('tbody tr');
            
            rows.forEach(row => {
                const totalCell = row.cells[row.cells.length - 2]; // Pen√∫ltima c√©lula (antes das a√ß√µes)
                const input = totalCell.querySelector('input');
                if (input && input.value) {
                    const valor = parseFloat(input.value.replace(/[^\d,]/g, '').replace(',', '.')) || 0;
                    total += valor;
                }
            });
            
            // Atualizar total na tabela
            const totalElement = tabela.querySelector('tfoot strong[id*="total"]');
            if (totalElement) {
                totalElement.textContent = 'R$ ' + total.toLocaleString('pt-BR', {minimumFractionDigits: 2});
            }
            
            atualizarResumoFinanceiro();
        }

        function atualizarResumoFinanceiro() {
            // Obter totais de cada se√ß√£o
            const totalServicos = obterTotalTabela('totalServicos');
            const totalMaoObra = obterTotalTabela('totalMaoObra');
            const totalMateriais = obterTotalTabela('totalMateriais');
            const totalEquipamentos = obterTotalTabela('totalEquipamentos');
            
            // Calcular custo direto (CORRIGIDO: apenas MO + Mat + Equip)
            const custoDirecto = totalMaoObra + totalMateriais + totalEquipamentos;
            
            // Calcular BDI
            const percentualBDI = parseFloat(document.getElementById('totalBDI').textContent.replace('%', '')) || 0;
            const valorBDI = custoDirecto * (percentualBDI / 100);
            
            // Calcular valor total (CORRIGIDO: Custo Direto + BDI)
            const valorTotal = custoDirecto + valorBDI;
            
            // Atualizar elementos do resumo
            document.getElementById('resumoServicos').textContent = formatarMoeda(totalServicos);
            document.getElementById('resumoMaoObra').textContent = formatarMoeda(totalMaoObra);
            document.getElementById('resumoMateriais').textContent = formatarMoeda(totalMateriais);
            document.getElementById('resumoEquipamentos').textContent = formatarMoeda(totalEquipamentos);
            document.getElementById('custoDirecto').textContent = formatarMoeda(custoDirecto);
            document.getElementById('percentualBDI').textContent = percentualBDI.toFixed(2);
            document.getElementById('valorBDI').textContent = formatarMoeda(valorBDI);
            document.getElementById('valorTotal').textContent = formatarMoeda(valorTotal);
            
            // Atualizar valor total na se√ß√£o de resumo
            document.getElementById('valorTotalProposta').textContent = formatarMoeda(valorTotal);
        }

        function obterTotalTabela(elementId) {
            const element = document.getElementById(elementId);
            if (!element) return 0;
            
            const texto = element.textContent.replace(/[^\d,]/g, '').replace(',', '.');
            return parseFloat(texto) || 0;
        }

        function formatarMoeda(valor) {
            return 'R$ ' + valor.toLocaleString('pt-BR', {minimumFractionDigits: 2});
        }

        // Fun√ß√µes para adicionar/remover linhas das tabelas
        function adicionarLinhaServicos() {
            const tbody = document.querySelector('#tabelaServicos tbody');
            const novaLinha = tbody.insertRow();
            novaLinha.innerHTML = `
                <td><input type="text" placeholder="${tbody.rows.length + 1}"></td>
                <td><input type="text" placeholder="Descri√ß√£o do servi√ßo"></td>
                <td><input type="text" placeholder="m¬≤"></td>
                <td><input type="number" step="0.01" placeholder="100" onchange="calcularTotal(this)"></td>
                <td><input type="number" step="0.01" placeholder="25.50" onchange="calcularTotal(this)"></td>
                <td><input type="text" readonly class="total-cell"></td>
                <td><button type="button" class="btn btn-danger btn-sm" onclick="removerLinha(this)">Remover</button></td>
            `;
        }

        function adicionarLinhaMaoObra() {
            const tbody = document.querySelector('#tabelaMaoObra tbody');
            const novaLinha = tbody.insertRow();
            novaLinha.innerHTML = `
                <td><input type="text" placeholder="Fun√ß√£o"></td>
                <td><input type="number" placeholder="1" onchange="calcularMaoObra(this)"></td>
                <td><input type="number" placeholder="8" onchange="calcularMaoObra(this)"></td>
                <td><input type="number" step="0.01" placeholder="2500" onchange="calcularMaoObra(this)"></td>
                <td><input type="number" step="0.01" placeholder="80" onchange="calcularMaoObra(this)"></td>
                <td><input type="text" readonly class="total-cell"></td>
                <td><input type="text" readonly class="total-cell"></td>
                <td><button type="button" class="btn btn-danger btn-sm" onclick="removerLinha(this)">Remover</button></td>
            `;
        }

        function adicionarLinhaMateriaisComercial() {
            const tbody = document.querySelector('#tabelaMateriaisComercial tbody');
            const novaLinha = tbody.insertRow();
            novaLinha.innerHTML = `
                <td><input type="text" placeholder="Material"></td>
                <td><input type="text" placeholder="Especifica√ß√£o"></td>
                <td><input type="text" placeholder="un"></td>
                <td><input type="number" step="0.01" placeholder="100" onchange="calcularTotal(this)"></td>
                <td><input type="number" step="0.01" placeholder="35.00" onchange="calcularTotal(this)"></td>
                <td><input type="text" readonly class="total-cell"></td>
                <td><button type="button" class="btn btn-danger btn-sm" onclick="removerLinha(this)">Remover</button></td>
            `;
        }

        function adicionarLinhaEquipamentosComercial() {
            const tbody = document.querySelector('#tabelaEquipamentosComercial tbody');
            const novaLinha = tbody.insertRow();
            novaLinha.innerHTML = `
                <td><input type="text" placeholder="Equipamento"></td>
                <td><input type="text" placeholder="Especifica√ß√£o"></td>
                <td><input type="number" placeholder="1" onchange="calcularEquipamento(this)"></td>
                <td><input type="number" placeholder="8" onchange="calcularEquipamento(this)"></td>
                <td><input type="number" step="0.01" placeholder="800" onchange="calcularEquipamento(this)"></td>
                <td><input type="text" readonly class="total-cell"></td>
                <td><button type="button" class="btn btn-danger btn-sm" onclick="removerLinha(this)">Remover</button></td>
            `;
        }

        function adicionarLinhaBDI() {
            const tbody = document.querySelector('#tabelaBDI tbody');
            const novaLinha = tbody.insertRow();
            novaLinha.innerHTML = `
                <td><input type="text" placeholder="Item do BDI"></td>
                <td><input type="number" step="0.01" placeholder="5.00" onchange="calcularBDI()"></td>
                <td><button type="button" class="btn btn-danger btn-sm" onclick="removerLinha(this)">Remover</button></td>
            `;
        }

        function adicionarLinhaEquipe() {
            const tbody = document.querySelector('#tabelaEquipe tbody');
            const novaLinha = tbody.insertRow();
            novaLinha.innerHTML = `
                <td><input type="text" placeholder="Fun√ß√£o"></td>
                <td><input type="number" placeholder="1"></td>
                <td><input type="number" placeholder="8"></td>
                <td><button type="button" class="btn btn-danger btn-sm" onclick="removerLinha(this)">Remover</button></td>
            `;
        }

        function adicionarLinhaMateriais() {
            const tbody = document.querySelector('#tabelaMateriais tbody');
            const novaLinha = tbody.insertRow();
            novaLinha.innerHTML = `
                <td><input type="text" placeholder="Material"></td>
                <td><input type="text" placeholder="Especifica√ß√£o"></td>
                <td><input type="text" placeholder="un"></td>
                <td><input type="number" placeholder="100"></td>
                <td><button type="button" class="btn btn-danger btn-sm" onclick="removerLinha(this)">Remover</button></td>
            `;
        }

        function adicionarLinhaEquipamentos() {
            const tbody = document.querySelector('#tabelaEquipamentos tbody');
            const novaLinha = tbody.insertRow();
            novaLinha.innerHTML = `
                <td><input type="text" placeholder="Equipamento"></td>
                <td><input type="text" placeholder="Especifica√ß√£o"></td>
                <td><input type="text" placeholder="un"></td>
                <td><input type="number" placeholder="2"></td>
                <td><button type="button" class="btn btn-danger btn-sm" onclick="removerLinha(this)">Remover</button></td>
            `;
        }

        function adicionarLinhaExperiencia() {
            const tbody = document.querySelector('#tabelaExperiencia tbody');
            const novaLinha = tbody.insertRow();
            novaLinha.innerHTML = `
                <td><input type="text" placeholder="Obra/Servi√ßo"></td>
                <td><input type="text" placeholder="Cliente"></td>
                <td><input type="text" placeholder="R$ 0,00"></td>
                <td><input type="number" placeholder="2023"></td>
                <td><button type="button" class="btn btn-danger btn-sm" onclick="removerLinha(this)">Remover</button></td>
            `;
        }

        function adicionarLinhaCertificacoes() {
            const tbody = document.querySelector('#tabelaCertificacoes tbody');
            const novaLinha = tbody.insertRow();
            novaLinha.innerHTML = `
                <td><input type="text" placeholder="Certifica√ß√£o"></td>
                <td><input type="text" placeholder="√ìrg√£o Emissor"></td>
                <td><input type="date"></td>
                <td><button type="button" class="btn btn-danger btn-sm" onclick="removerLinha(this)">Remover</button></td>
            `;
        }

        function removerLinha(button) {
            const row = button.closest('tr');
            const tabela = button.closest('table');
            row.remove();
            
            // Atualizar totais se for uma tabela com c√°lculos
            if (tabela.id.includes('Servicos') || tabela.id.includes('MaoObra') || 
                tabela.id.includes('Materiais') || tabela.id.includes('Equipamentos')) {
                atualizarTotalTabela(tabela);
            }
            
            if (tabela.id === 'tabelaBDI') {
                calcularBDI();
            }
        }

        // Fun√ß√µes de revis√£o
        function atualizarRevisao() {
            // Dados da empresa
            document.getElementById('revisaoRazaoSocial').textContent = 
                document.getElementById('razaoSocial').value || '-';
            document.getElementById('revisaoCNPJ').textContent = 
                document.getElementById('cnpj').value || '-';
            document.getElementById('revisaoRespTecnico').textContent = 
                document.getElementById('respTecnico').value || '-';
            
            // Dados financeiros
            document.getElementById('revisaoCustoDirecto').textContent = 
                document.getElementById('custoDirecto').textContent;
            document.getElementById('revisaoBDI').textContent = 
                document.getElementById('valorBDI').textContent;
            document.getElementById('revisaoValorTotal').textContent = 
                document.getElementById('valorTotal').textContent;
            document.getElementById('revisaoPrazo').textContent = 
                (document.getElementById('prazoExecucao').value || '-') + ' dias';
            document.getElementById('revisaoPagamento').textContent = 
                document.getElementById('formaPagamento').value || '-';
        }

        // Fun√ß√£o de envio
        function enviarProposta() {
            // Verificar declara√ß√µes
            if (!document.getElementById('declaracao1').checked ||
                !document.getElementById('declaracao2').checked ||
                !document.getElementById('declaracao3').checked) {
                alert('Por favor, marque todas as declara√ß√µes obrigat√≥rias.');
                return;
            }
            
            // Verificar campos obrigat√≥rios
            const camposObrigatorios = [
                'razaoSocial', 'cnpj', 'endereco', 'cidade', 'telefone', 'email', 
                'respTecnico', 'crea', 'prazoExecucao', 'formaPagamento'
            ];
            
            for (let campo of camposObrigatorios) {
                if (!document.getElementById(campo).value.trim()) {
                    alert(`Por favor, preencha o campo: ${campo}`);
                    return;
                }
            }
            
            // Coletar todos os dados
            const dadosProposta = coletarDadosProposta();
            
            // Enviar para o backend
            fetch('http://localhost:5000/enviar-proposta', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(dadosProposta)
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    alert(`‚úÖ Proposta enviada com sucesso!\n\nProtocolo: ${data.protocolo}\n\nVoc√™ receber√° um e-mail de confirma√ß√£o em breve.`);
                    
                    // Salvar proposta localmente
                    propostas.push(dadosProposta);
                    localStorage.setItem('propostas', JSON.stringify(propostas));
                    
                    // Limpar formul√°rio
                    limparFormularioPortal();
                    
                    // Voltar para o dashboard
                    mostrarSecao('dashboard');
                } else {
                    alert(`‚ùå Erro ao enviar proposta: ${data.message}`);
                }
            })
            .catch(error => {
                console.error('Erro:', error);
                alert('‚ùå Erro de conex√£o. Verifique se o servidor est√° funcionando.');
            });
        }

        function coletarDadosProposta() {
            const protocolo = 'PROP-' + Date.now().toString().slice(-6) + '-' + Math.floor(Math.random() * 1000);
            
            return {
                protocolo: protocolo,
                numeroProcesso: document.getElementById('numeroProcessoPortal').value,
                dataEnvio: new Date().toISOString(),
                dados: {
                    razaoSocial: document.getElementById('razaoSocial').value,
                    cnpj: document.getElementById('cnpj').value,
                    endereco: document.getElementById('endereco').value,
                    cidade: document.getElementById('cidade').value,
                    telefone: document.getElementById('telefone').value,
                    email: document.getElementById('email').value,
                    respTecnico: document.getElementById('respTecnico').value,
                    crea: document.getElementById('crea').value
                },
                resumo: {
                    prazoExecucao: document.getElementById('prazoExecucao').value,
                    formaPagamento: document.getElementById('formaPagamento').value
                },
                tecnica: {
                    objetoConcorrencia: document.getElementById('objetoConcorrencia').value,
                    escopoInclusos: document.getElementById('escopoInclusos').value,
                    escopoExclusos: document.getElementById('escopoExclusos').value,
                    metodologia: document.getElementById('metodologia').value,
                    sequenciaExecucao: document.getElementById('sequenciaExecucao').value,
                    estruturaCanteiro: document.getElementById('estruturaCanteiro').value,
                    obrigacoesContratada: document.getElementById('obrigacoesContratada').value,
                    obrigacoesContratante: document.getElementById('obrigacoesContratante').value,
                    garantias: document.getElementById('garantias').value,
                    equipe: coletarDadosTabela('tabelaEquipe'),
                    materiais: coletarDadosTabela('tabelaMateriais'),
                    equipamentos: coletarDadosTabela('tabelaEquipamentos'),
                    experiencia: coletarDadosTabela('tabelaExperiencia'),
                    certificacoes: coletarDadosTabela('tabelaCertificacoes'),
                    cronograma: document.getElementById('cronogramaTabela').innerHTML || ''
                },
                comercial: {
                    servicos: coletarDadosTabela('tabelaServicos'),
                    maoObra: coletarDadosTabela('tabelaMaoObra'),
                    materiaisComercial: coletarDadosTabela('tabelaMateriaisComercial'),
                    equipamentosComercial: coletarDadosTabela('tabelaEquipamentosComercial'),
                    bdi: coletarDadosTabela('tabelaBDI'),
                    totalServicos: document.getElementById('totalServicos').textContent,
                    totalMaoObra: document.getElementById('totalMaoObra').textContent,
                    totalMateriais: document.getElementById('totalMateriais').textContent,
                    totalEquipamentos: document.getElementById('totalEquipamentos').textContent,
                    custoDirecto: document.getElementById('custoDirecto').textContent,
                    bdiValor: document.getElementById('valorBDI').textContent,
                    valorTotal: document.getElementById('valorTotal').textContent,
                    validadeProposta: document.getElementById('validadeProposta').value,
                    condicoes: document.getElementById('condicoes').value
                }
            };
        }

        function coletarDadosTabela(tabelaId) {
            const tabela = document.getElementById(tabelaId);
            if (!tabela) return [];
            
            const dados = [];
            const rows = tabela.querySelectorAll('tbody tr');
            
            rows.forEach(row => {
                const rowData = [];
                const inputs = row.querySelectorAll('input');
                inputs.forEach(input => {
                    rowData.push(input.value);
                });
                if (rowData.some(data => data.trim() !== '')) {
                    dados.push(rowData);
                }
            });
            
            return dados;
        }

        // Fun√ß√µes de persist√™ncia
        function salvarDadosPortal() {
            if (!portalAberto) return;
            
            const dados = {
                timestamp: Date.now(),
                dados: {
                    razaoSocial: document.getElementById('razaoSocial').value,
                    cnpj: document.getElementById('cnpj').value,
                    endereco: document.getElementById('endereco').value,
                    cidade: document.getElementById('cidade').value,
                    telefone: document.getElementById('telefone').value,
                    email: document.getElementById('email').value,
                    respTecnico: document.getElementById('respTecnico').value,
                    crea: document.getElementById('crea').value
                },
                resumo: {
                    prazoExecucao: document.getElementById('prazoExecucao').value,
                    formaPagamento: document.getElementById('formaPagamento').value
                }
            };
            
            localStorage.setItem('dadosPortalTemp', JSON.stringify(dados));
        }

        function carregarDadosPortal() {
            const dados = localStorage.getItem('dadosPortalTemp');
            if (!dados) return;
            
            try {
                const dadosObj = JSON.parse(dados);
                
                // Carregar dados cadastrais
                if (dadosObj.dados) {
                    Object.keys(dadosObj.dados).forEach(key => {
                        const element = document.getElementById(key);
                        if (element) element.value = dadosObj.dados[key];
                    });
                }
                
                // Carregar resumo
                if (dadosObj.resumo) {
                    Object.keys(dadosObj.resumo).forEach(key => {
                        const element = document.getElementById(key);
                        if (element) element.value = dadosObj.resumo[key];
                    });
                }
            } catch (e) {
                console.error('Erro ao carregar dados salvos:', e);
            }
        }

        function carregarDadosProcesso(numeroProcesso) {
            const processo = processos.find(p => p.numero === numeroProcesso);
            if (processo) {
                document.getElementById('numeroProcessoPortal').value = processo.numero;
                document.getElementById('objetoProcesso').value = processo.objeto;
                document.getElementById('resumoProcesso').textContent = processo.numero;
                document.getElementById('resumoModalidade').textContent = processo.modalidade;
                document.getElementById('resumoValorEstimado').textContent = 
                    'R$ ' + processo.valorEstimado.toLocaleString('pt-BR', {minimumFractionDigits: 2});
            }
        }

        function limparFormularioPortal() {
            // Limpar todos os inputs do portal
            document.querySelectorAll('#portalContainer input, #portalContainer textarea, #portalContainer select').forEach(element => {
                if (element.type === 'checkbox') {
                    element.checked = false;
                } else {
                    element.value = '';
                }
            });
            
            // Limpar dados salvos
            localStorage.removeItem('dadosPortalTemp');
            
            // Voltar para primeira aba
            mostrarAba('dados');
        }

        // Verificar par√¢metros da URL ao carregar
        window.addEventListener('load', function() {
            const urlParams = new URLSearchParams(window.location.search);
            if (urlParams.get('portal') === 'true') {
                abrirPortal();
                const processoId = urlParams.get('processo');
                if (processoId) {
                    carregarDadosProcesso(processoId);
                }
            }
        });
    </script>
</body>
</html>

